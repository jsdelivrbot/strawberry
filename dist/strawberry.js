var swby=swby||{};swby.lang={};var swby_global=this;swby.lang.namespace=function(e){var t=e.split(".");swby.lang.assert(t.length>0);var n=swby_global;for(var r=0;r<t.length;++r){var i=n[t[r]];i||(i={},n[t[r]]=i),n=i}},swby.lang.assert=function(e,t){if(!e)throw new Error(t||"Assertion error")},swby.lang.inherits=function(e,t){function n(){}n.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new n,e.prototype.constructor=e},swby.lang.abstractMethod=function(){throw new Error("Abstract method not implemented")},swby.lang.notImplementedMethod=function(){throw new Error("Method not implemented")},swby.lang.singleton=function(e){e.getInstance=function(){return e.instance_?e.instance_:e.instance_=new e}},swby.lang.makeEnum=function(e){var t={};return e.forEach(function(e){t[e]=e}),t};var swby=swby||{};swby.promise={},swby.promise.isArray_=function(e){return e instanceof Array||typeof e=="array"},swby.promise.isFunction_=function(e){return typeof e=="function"},swby.promise.ifFunction_=function(e){return swby.promise.isFunction_(e)?e:null},swby.promise.isObject_=function(e){var t=typeof e;return t=="object"&&e!=null||t=="function"},swby.promise.async_=function(e,t,n){setTimeout(e.bind(t,n),0)},swby.promise.State_={PENDING:0,FULFILLED:1,REJECTED:2},swby.promise.Promise=function(e,t){this.state_=swby.promise.State_.PENDING,this.children_=[];if(e)try{e.call(t||this,this.fulfill_.bind(this),this.reject_.bind(this))}catch(n){this.reject_(n)}},swby.promise.Promise.prototype.fulfill_=function(e){if(this.state_!=swby.promise.State_.PENDING)return;this.state_=swby.promise.State_.FULFILLED,this.value_=e,this.resolveAndClearChildren_()},swby.promise.Promise.prototype.reject_=function(e){if(this.state_!=swby.promise.State_.PENDING)return;this.state_=swby.promise.State_.REJECTED,this.reason_=e,this.resolveAndClearChildren_()},swby.promise.Promise.prototype.then=function(e,t,n){var r=new swby.promise.ChildPromise_(swby.promise.ifFunction_(e),swby.promise.ifFunction_(t),n);return this.state_==swby.promise.State_.PENDING?this.children_.push(r):swby.promise.async_(this.resolveChild_,this,r),r},swby.promise.resolve_=function(e,t){if(e===t)e.reject_(new TypeError);else if(swby.promise.isObject_(t)){try{var n=t.then}catch(r){e.reject_(r);return}if(swby.promise.isFunction_(n)){var i=!1;try{n.call(t,function(t){if(i)return;i=!0,swby.promise.resolve_(e,t)},function(t){if(i)return;i=!0,e.reject_(t)})}catch(r){i||e.reject_(r)}}else e.fulfill_(t)}else e.fulfill_(t)},swby.promise.Promise.prototype.resolveChild_=function(e){if(this.state_==swby.promise.State_.FULFILLED)if(e.onFulfilled_){try{var t=e.onFulfilled_.call(e.context_,this.value_)}catch(n){e.reject_(n);return}swby.promise.resolve_(e,t)}else e.fulfill_(this.value_);else{swby.lang.assert(this.state_==swby.promise.State_.REJECTED);if(e.onRejected_){try{var t=e.onRejected_.call(e.context_,this.reason_)}catch(n){e.reject_(n);return}swby.promise.resolve_(e,t)}else e.reject_(this.reason_)}},swby.promise.Promise.prototype.resolveAndClearChildren_=function(){var e=this.children_;this.children_=[],swby.promise.async_(function(){for(var t=0;t<e.length;++t)this.resolveChild_(e[t])},this)},swby.promise.ChildPromise_=function(e,t,n){swby.promise.Promise.call(this),this.onFulfilled_=e,this.onRejected_=t,this.context_=n},swby.lang.inherits(swby.promise.ChildPromise_,swby.promise.Promise),swby.promise.forEach_=function(e,t,n){if(swby.promise.isArray_(e))e.forEach(t,n);else for(var r in e)t.call(n,e[r],r)},swby.promise.getSize_=function(e){if(swby.promise.isArray_(e))return e.length;var t=0;for(var n in e)++t;return t},swby.promise.all=function(e){var t=1,n=swby.promise.isArray_(e)?[]:{},r=!1;return new swby.promise.Promise(function(i,s){function o(){--t,t==0&&i(n)}swby.promise.forEach_(e,function(e,i){++t,e.then(function(e){if(r)return;n[i]=e,o()},function(e){if(r)return;r=!0,s(e)})}),o()})},swby.promise.any=function(e){var t=1,n=swby.promise.isArray_(e)?[]:{},r=!1;return new swby.promise.Promise(function(i,s){function o(){--t,t==0&&s(n)}swby.promise.forEach_(e,function(e,s){++t,e.then(function(e){if(r)return;r=!0,i(e)},function(e){if(r)return;n[s]=e,o()})}),o()})},swby.promise.fulfilled=function(e){return new swby.promise.Promise(function(t,n){t(e)})},swby.promise.rejected=function(e){return new swby.promise.Promise(function(t,n){n(e)})},swby.promise.create=function(e,t){return new swby.promise.Promise(e,t)},swby.promise.AbortablePromise=function(e,t,n){this.abort_=t,this.context_=n||this,swby.promise.Promise.call(this,e,n)},swby.lang.inherits(swby.promise.AbortablePromise,swby.promise.Promise),swby.promise.AbortablePromise.prototype.abort=function(){this.abort_&&this.abort_.call(this.context_)},swby.promise.Timeout_=function(e,t){this.promise_=e,swby.promise.Promise.call(this,function(n,r){this.reject_=r,this.timeout_=setTimeout(this.onTimeout_.bind(this),t),e.then(function(e){if(!this.clearTimeout_())return;n(e)},function(e){if(!this.clearTimeout_())return;r(e)},this)},this)},swby.lang.inherits(swby.promise.Timeout_,swby.promise.Promise),swby.promise.Timeout_.onTimeout_=function(){if(!this.clearTimeout_())return;this.promise_.abort&&this.promise_.abort(),this.reject_("timeout")},swby.promise.Timeout_.clearTimeout_=function(){return this.timeout_?(clearTimeout(this.timeout_),this.timeout_=null,!0):!1},swby.promise.timeout=function(e,t){return new swby.promise.Timeout_(e,t)},swby.promise.delay=function(e){return new swby.promise.AbortablePromise(function(t,n){var r=this;this.delay_=setTimeout(function(){r.delay_=null,t(null)},e)},function(){this.delay_&&clearTimeout(this.delay_)},this)},swby.promise.onDomEvent=function(e,t){return new swby.promise.AbortablePromise(function(n,r){var i=this;i.eventHandler_=function(r){e.removeEventListener(t,i.eventHandler_),n(r)},e.addEventListener(t,this.eventHandler_,!1)},function(){e.removeEventListener(t,this.eventHandler_)},this)},swby.lang.namespace("swby.util"),swby.util.getAncestorByClass=function(e,t){while(e){if(e.classList.contains(t))return e;e=e.parentNode}return null},swby.util.getElementByClassName=function(e,t){var n=e.getElementsByClassName(t);return n.length==0?null:n[0]},swby.util.clone=function(e){var t={};for(var n in e)t[n]=e[n];return t},swby.util.getSelectValue=function(e){var t=e.selectedIndex;return t>=0?e.options[t].value:null},swby.util.forEach2=function(e,t,n,r){swby.lang.assert(e.length==t.length);for(var i=0;i<e.length;++i)n.call(r,e[i],t[i],i)},swby.util.forEach3=function(e,t,n,r,i){swby.lang.assert(e.length==t.length),swby.lang.assert(e.length==n.length);for(var s=0;s<e.length;++s)r.call(i,e[s],t[s],n[s],s)},swby.util.createDom=function(e,t,n){var r=document.createElement(e);if(t)if(typeof t=="string")r.className=t;else for(var i in t)i=="className"?r.className=t[i]:r.setAttribute(i,t[i]);return n&&(typeof n=="string"?r.textContent=n:n.forEach(function(e){e&&r.appendChild(e)})),r},swby.util.getDate_=function(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())},swby.util.numberOfDays_=function(e,t){var n=new swby.util.getDate_(e),r=new swby.util.getDate_(t);return Math.round((r.getTime()-n.getTime())/864e5)},swby.util.padOnTwoDigits_=function(e){return e<10?"0"+e:""+e},swby.util.formatTime_=function(e){return swby.util.padOnTwoDigits_(e.getHours())+":"+swby.util.padOnTwoDigits_(e.getMinutes())},swby.util.DAYS_OF_WEEK_=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],swby.util.formatEventWhen=function(e,t){var n=new Date,r=new Date(e),i=new Date(t),s="",o=swby.util.numberOfDays_(n,r);o==0?s+="Today":o>0&&o<7?s+=swby.util.DAYS_OF_WEEK_[r.getDay()]:s+=e.substr(0,10),s+=", "+swby.util.formatTime_(r)+" to "+swby.util.formatTime_(i);var u=swby.util.numberOfDays_(r,i);return u!=0&&(s+=" (+"+u+")"),s},swby.util.renderHtmlAsElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},swby.lang.namespace("swby.base"),swby.base.Disposable=function(){this.disposables_=[],this.disposed_=!1},swby.base.Disposable.prototype.dispose=function(){if(this.isDisposed())return;this.disposables_.forEach(function(e){e.dispose()},this),this.disposeInternal_(),this.disposed_=!0},swby.base.Disposable.prototype.isDisposed=function(){return this.disposed_},swby.base.Disposable.prototype.disposeInternal_=function(){},swby.base.Disposable.prototype.registerDisposable=function(e){return this.disposables_.push(e),e},swby.base.EventHandler=function(e){swby.base.Disposable.call(this),this.this_=e||this,this.handlers_=[]},swby.lang.inherits(swby.base.EventHandler,swby.base.Disposable),swby.base.EventHandler.prototype.dispose=function(){this.handlers_.forEach(function(e){e.target.removeEventListener(e.eventType,e.handler,e.useCapture)},this),swby.base.EventHandler.prototype.dispose.call(this)},swby.base.EventHandler.prototype.listen=function(e,t,n,r){var i=n.bind(this.this_);typeof t=="string"&&(t=[t]);var s=r||!1;t.forEach(function(t){e.addEventListener(t,i,s),this.handlers_.push({target:e,eventType:t,handler:i,useCapture:s})},this)},swby.base.ERROR_DIALOG_HTML_='  <div class="modal fade" id="my-modal">    <div class="modal-dialog">      <div class="modal-content">        <div class="modal-header">          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>          <h4 class="modal-title text-danger lead">Oops! Something went wrong</h4>        </div>        <div class="modal-body">          <div class="error-reporter-message lead"></div>          <div class="error-reporter-details" style="white-space: pre-wrap;"></div>        </div>        <div class="modal-footer">          <button type="button" class="btn btn-danger" data-dismiss="modal">Continue</button>        </div>      </div>    </div>  </div>',swby.base.showErrorDialog=function(e,t,n){function r(e,t){t?e.textContent=t:e.style.display="none"}function i(e,t){return"Error "+e+(t?": "+t:"")}var s=swby.util.renderHtmlAsElement(swby.base.ERROR_DIALOG_HTML_);document.body.appendChild(s),r(swby.util.getElementByClassName(s,"error-reporter-message"),e),typeof t=="object"&&(t.error&&t.error.code?t=i(t.error.code,t.error.message):t.result&&t.result.error&&t.result.error.code?t=i(t.result.error.code,t.result.error.message||t.statusText):t.status&&t.statusText?t=i(t.status,t.statusText):t=null),r(swby.util.getElementByClassName(s,"error-reporter-details"),t),n&&(swby.util.getElementByClassName(s,"modal-footer").style.display="none",swby.util.getElementByClassName(s,"close").style.display="none"),$(s).modal("show"),$(s).on("hidden.bs.modal",function(e){document.body.removeChild(s)})},swby.base.reportApiError_=function(e,t,n){swby.base.showErrorDialog(e,n,t)},swby.base.apiErrorHandler=function(e,t){return swby.base.reportApiError_.bind(null,e||"An API call failed",t||!1)},swby.base.Page=function(){swby.base.EventHandler.call(this),this.queryParameters=this.parseQueryString_(document.location.search)},swby.lang.inherits(swby.base.Page,swby.base.EventHandler),swby.base.Page.prototype.init=function(){this.loaded()},swby.base.Page.prototype.loaded=function(){document.body.classList.remove("loading")},swby.base.Page.prototype.parseQueryString_=function(e){var t={};return decodeURIComponent(e).substr(1).split("&").forEach(function(e){var n=e.split("=",2);t[n[0]]=n[1]||"true"}),t},swby.base.Page.prototype.onload=swby.lang.abstractMethod,swby.base.Config,swby.base.Loader=function(e,t){swby.base.EventHandler.call(this),this.config_=e,this.page_class_=t,this.page_=null,swby.promise.all([swby.promise.onDomEvent(document,"DOMContentLoaded").then(function(e){this.page_=new this.page_class_},this.reportError_,this),this.loadGoogleApi_().then(function(){return new swby.promise.all([this.loadApis_(),this.authorize_()])},this.reportError_,this)]).then(function(){this.page_.init(),window.setInterval(this.refreshToken_.bind(this),this.token_refresh_interval_ms_)},this.reportError_,this)},swby.lang.inherits(swby.base.Loader,swby.base.EventHandler),swby.base.Loader.prototype.gapi_callback_="cranberry_gapi_loaded",swby.base.Loader.prototype.gapi_url_="https://apis.google.com/js/client.js?onload=",swby.base.Loader.prototype.xhr_timeout_ms_=5e3,swby.base.Loader.prototype.get_token_path_="/oauth2/token",swby.base.Loader.prototype.token_lifetime_s_=3e3,swby.base.Loader.prototype.token_refresh_interval_ms_=27e5,swby.base.Loader.AUTH_DIALOG_HTML_='  <div class="modal fade" id="my-modal">    <div class="modal-dialog">      <div class="modal-content">        <div class="modal-header">          <h4 class="modal-title">Authorization needed</h4>        </div>        <div class="modal-body">          <p>This application requires authorization to access some Google APIs. Please click on "Proceed" to run through the authorization process.          This will open a popup window from Google where you will be to review the access rights and approve them.</p>        </div>        <div class="modal-footer">          <button type="button" class="btn btn-primary" data-dismiss="modal">Proceed</button>        </div>      </div>    </div>  </div>',swby.base.Loader.prototype.reportError_=function(e){swby.base.showErrorDialog(e.message,e.details,!0)},swby.base.Loader.prototype.loadGoogleApi_=function(){return new swby.promise.Promise(function(e,t){var n=this.gapi_callback_;window[n]=function(){delete window[n],e()},document.write('<script type="application/javascript" src="'+this.gapi_url_+n+'"></script>')},this)},swby.base.Loader.prototype.authorize_=function(){return this.config_.api_key&&gapi.auth.setApiKey(this.config_.api_key),this.config_.get_token_from_server?this.getOAuth2TokenFromServer_():this.config_.scopes&&this.config_.scopes.length>0?this.authorizeLocally_():swby.promise.resolved(null)},swby.base.Loader.prototype.getOAuth2TokenFromServer_=function(){return new swby.promise.Promise(function(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(r){if(n.readyState!=4)return;if(n.status==200){try{var i=JSON.parse(n.responseText)}catch(s){var i=null}i?i.status==200?(gapi.auth.setToken(i.result),e(null)):t({message:"Cannot get OAuth2 token",details:i}):t({message:"Cannot get OAuth2 token",details:"The server returned a malformed response:\n"+n.responseText})}else n.status==0?t({message:"Cannot get OAuth2 token",details:"Timeout"}):t({message:"Cannot get OAuth2 token",details:n})}.bind(this),n.timeout=this.xhr_timeout_ms_,n.open("GET",this.get_token_path_+"?min_lifetime_seconds="+this.token_lifetime_s_),n.send()},this)},swby.base.Loader.prototype.authorizeLocallyAttempt_=function(e,t,n){var r=this;gapi.auth.authorize({client_id:this.config_.client_id,scope:this.config_.scopes.join(" "),immediate:e},function(i){i.error?e?r.showAuthDialog_(function(){r.authorizeLocallyAttempt_(!1,t,n)}):n({message:"Authorization failure ("+i.error+")"}):t()})},swby.base.Loader.prototype.authorizeLocally_=function(){return new swby.promise.Promise(function(e,t){this.authorizeLocallyAttempt_(!0,e,t)},this)},swby.base.Loader.prototype.showAuthDialog_=function(e){var t=swby.util.renderHtmlAsElement(swby.base.Loader.AUTH_DIALOG_HTML_);document.body.appendChild(t),$(t).modal("show"),$(t).on("hidden.bs.modal",function(n){document.body.removeChild(t),e()})},swby.base.Loader.prototype.loadApis_=function(){var e=[];return this.config_.apis.forEach(function(t){var n=t.root;n&&n.charAt(0)=="/"&&n.charAt(1)!="/"&&(n="//"+window.location.host+n),e.push(new swby.promise.Promise(function(e,r){gapi.client.load(t.name,t.version,null,n).then(function(n){n&&n.error?r({message:'Cannot load API "'+t.name+'" ('+t.version+")",details:n}):e()},r,this)},this))},this),swby.promise.all(e)},swby.base.Loader.prototype.refreshToken_=function(){this.config_.get_token_from_server?this.getOAuth2TokenFromServer_():this.authorize_()},swby.base.init=function(e,t){new swby.base.Loader(e,t)};